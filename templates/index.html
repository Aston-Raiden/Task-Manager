<!DOCTYPE html>
<html>
<head>
    <title>Task Manager</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        
        .actions { padding: 20px; background: #f8f9fa; border-bottom: 1px solid #eee; display: flex; gap: 10px; }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; border: none; cursor: pointer; font-weight: 500; transition: all 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,123,255,0.3); }
        .btn-success { background: #28a745; }
        .btn-success:hover { box-shadow: 0 4px 8px rgba(40,167,69,0.3); }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { box-shadow: 0 4px 8px rgba(220,53,69,0.3); }
        
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-top: 4px solid #007bff; }
        .stat-card h3 { font-size: 2rem; color: #007bff; margin-bottom: 5px; }
        .stat-card p { color: #666; font-weight: 500; }
        
        .tasks-container { padding: 20px; }
        .task-card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-left: 5px solid #007bff; transition: all 0.3s; animation: slideIn 0.5s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .task-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .task-card.completed { opacity: 0.7; border-left-color: #28a745; }
        .task-card.priority-1 { border-left-color: #dc3545; }
        .task-card.priority-2 { border-left-color: #fd7e14; }
        .task-card.priority-3 { border-left-color: #007bff; }
        .task-card.priority-4 { border-left-color: #17a2b8; }
        .task-card.priority-5 { border-left-color: #6c757d; }
        
        .task-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .task-header h3 { display: flex; align-items: center; gap: 10px; font-size: 1.3rem; }
        .task-actions { display: flex; gap: 8px; }
        .btn-icon { background: none; border: none; cursor: pointer; font-size: 1.1rem; padding: 8px; border-radius: 50%; transition: all 0.2s; width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center; }
        .toggle-btn { color: #28a745; }
        .toggle-btn:hover { background: rgba(40,167,69,0.1); }
        .edit-btn { color: #007bff; }
        .edit-btn:hover { background: rgba(0,123,255,0.1); }
        .delete-btn { color: #dc3545; }
        .delete-btn:hover { background: rgba(220,53,69,0.1); }
        
        .task-description { color: #666; margin: 10px 0; line-height: 1.5; padding-left: 24px; }
        .task-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; }
        .task-meta { display: flex; gap: 10px; align-items: center; }
        .priority-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; display: inline-flex; align-items: center; gap: 5px; }
        .priority-badge.priority-1 { background: rgba(220,53,69,0.1); color: #dc3545; }
        .priority-badge.priority-2 { background: rgba(253,126,20,0.1); color: #fd7e14; }
        .priority-badge.priority-3 { background: rgba(0,123,255,0.1); color: #007bff; }
        .priority-badge.priority-4 { background: rgba(23,162,184,0.1); color: #17a2b8; }
        .priority-badge.priority-5 { background: rgba(108,117,125,0.1); color: #6c757d; }
        
        .due-date { display: inline-flex; align-items: center; gap: 5px; padding: 5px 12px; background: #f8f9fa; border-radius: 20px; font-size: 0.85rem; color: #666; }
        .due-date.overdue { background: rgba(220,53,69,0.1); color: #dc3545; font-weight: 600; }
        .task-dates { color: #888; font-size: 0.85rem; display: flex; gap: 15px; }
        
        .empty-state { text-align: center; padding: 60px 20px; color: #666; }
        .empty-state i { font-size: 3rem; color: #007bff; opacity: 0.5; margin-bottom: 20px; }
        .empty-state h2 { color: #333; margin-bottom: 10px; }
        .empty-state p { margin-bottom: 30px; font-size: 1.1rem; }
        
        .alert { padding: 15px; border-radius: 5px; margin: 15px; display: flex; align-items: center; gap: 10px; }
        .alert-success { background: rgba(40,167,69,0.1); border-left: 4px solid #28a745; color: #155724; }
        .alert-error { background: rgba(220,53,69,0.1); border-left: 4px solid #dc3545; color: #721c24; }
        
        footer { padding: 20px; text-align: center; color: #666; border-top: 1px solid #eee; margin-top: 20px; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-tasks"></i> Task Manager</h1>
            <p>Organize your tasks efficiently and stay productive</p>
        </div>
        
        <div class="actions">
            <a href="{{ url_for('create_task') }}" class="btn">
                <i class="fas fa-plus"></i> Add New Task
            </a>
            <a href="{{ url_for('api_get_tasks') }}" class="btn" target="_blank">
                <i class="fas fa-code"></i> View API
            </a>
        </div>
        
        {% if tasks %}
        <div class="stats">
            <div class="stat-card">
                <h3>{{ tasks|length }}</h3>
                <p>Total Tasks</p>
            </div>
            <div class="stat-card">
                <h3>{{ tasks|selectattr('completed')|list|length }}</h3>
                <p>Completed</p>
            </div>
            <div class="stat-card">
                <h3>{{ tasks|rejectattr('completed')|list|length }}</h3>
                <p>Pending</p>
            </div>
        </div>
        
        <div class="tasks-container" id="tasksContainer">
            {% for task in tasks %}
            <div class="task-card priority-{{ task.priority }} {% if task.completed %}completed{% endif %}" id="task-{{ task.id }}">
                <div class="task-header">
                    <h3>
                        {% if task.completed %}
                            <i class="fas fa-check-circle completed-icon" style="color: #28a745;"></i>
                        {% else %}
                            <i class="fas fa-circle-notch pending-icon" style="color: #6c757d;"></i>
                        {% endif %}
                        {{ task.title }}
                    </h3>
                    <div class="task-actions">
                        <button class="btn-icon toggle-btn" onclick="toggleTask({{ task.id }})" 
                                title="{% if task.completed %}Mark as pending{% else %}Mark as completed{% endif %}">
                            {% if task.completed %}
                                <i class="fas fa-undo"></i>
                            {% else %}
                                <i class="fas fa-check"></i>
                            {% endif %}
                        </button>
                        
                        <a href="{{ url_for('edit_task', task_id=task.id) }}" class="btn-icon edit-btn" title="Edit">
                            <i class="fas fa-edit"></i>
                        </a>
                        
                        <button class="btn-icon delete-btn" onclick="deleteTask({{ task.id }})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                {% if task.description %}
                    <div class="task-description">
                        {{ task.description }}
                    </div>
                {% endif %}
                
                <div class="task-footer">
                    <div class="task-meta">
                        <span class="priority-badge priority-{{ task.priority }}">
                            <i class="fas fa-flag"></i> Priority {{ task.priority }}
                        </span>
                        
                        {% if task.due_date %}
                            <span class="due-date {% if task.due_date < now().strftime('%Y-%m-%d') and not task.completed %}overdue{% endif %}">
                                <i class="fas fa-calendar-alt"></i> 
                                Due: {{ task.due_date }}
                            </span>
                        {% endif %}
                    </div>
                    
                    <div class="task-dates">
                        <small>Created: {{ task.created_at[:10] }}</small>
                        {% if task.updated_at and task.updated_at[:10] != task.created_at[:10] %}
                            <small>Updated: {{ task.updated_at[:10] }}</small>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <i class="fas fa-clipboard-list"></i>
            <h2>No tasks yet</h2>
            <p>Get started by creating your first task!</p>
            <a href="{{ url_for('create_task') }}" class="btn">
                <i class="fas fa-plus"></i> Create Your First Task
            </a>
        </div>
        {% endif %}
        
        <footer>
            <p>Task Manager &copy; {{ now().year }} | Built with Flask & SQLite</p>
        </footer>
    </div>
    
    <div id="alertContainer" style="position: fixed; top: 20px; right: 20px; width: 300px; z-index: 1000;"></div>
    
    <script>
    // Function to show alerts
    function showAlert(message, type = 'success') {
        const alertContainer = document.getElementById('alertContainer');
        const alert = document.createElement('div');
        alert.className = `alert alert-${type}`;
        alert.innerHTML = `
            <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
            <span>${message}</span>
        `;
        alertContainer.appendChild(alert);
        
        // Remove alert after 3 seconds
        setTimeout(() => {
            alert.style.opacity = '0';
            setTimeout(() => alert.remove(), 300);
        }, 3000);
    }
    
    // Function to toggle task completion
    async function toggleTask(taskId) {
        try {
            const response = await fetch(`/task/toggle/${taskId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            
            const data = await response.json();
            
            if (data.success) {
                // Update the task card visually
                const taskCard = document.getElementById(`task-${taskId}`);
                const toggleBtn = taskCard.querySelector('.toggle-btn');
                const icon = taskCard.querySelector('.completed-icon, .pending-icon');
                const dueDate = taskCard.querySelector('.due-date');
                
                // Toggle completed class
                taskCard.classList.toggle('completed');
                
                // Update icon
                if (data.completed) {
                    icon.className = 'fas fa-check-circle completed-icon';
                    icon.style.color = '#28a745';
                    toggleBtn.innerHTML = '<i class="fas fa-undo"></i>';
                    toggleBtn.title = 'Mark as pending';
                    
                    // Remove overdue styling if present
                    if (dueDate) {
                        dueDate.classList.remove('overdue');
                    }
                } else {
                    icon.className = 'fas fa-circle-notch pending-icon';
                    icon.style.color = '#6c757d';
                    toggleBtn.innerHTML = '<i class="fas fa-check"></i>';
                    toggleBtn.title = 'Mark as completed';
                    
                    // Add overdue styling if needed
                    if (dueDate && new Date(dueDate.textContent.split(': ')[1]) < new Date()) {
                        dueDate.classList.add('overdue');
                    }
                }
                
                showAlert(data.message, 'success');
                
                // Update stats
                updateStats();
            } else {
                showAlert(data.message || 'Failed to update task', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showAlert('An error occurred while updating the task', 'error');
        }
    }
    
    // Function to delete task
    async function deleteTask(taskId) {
        if (!confirm('Are you sure you want to delete this task?')) {
            return;
        }
        
        try {
            const response = await fetch(`/task/delete/${taskId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            
            const data = await response.json();
            
            if (data.success) {
                // Remove task card with animation
                const taskCard = document.getElementById(`task-${taskId}`);
                taskCard.style.opacity = '0';
                taskCard.style.transform = 'translateX(20px)';
                
                setTimeout(() => {
                    taskCard.remove();
                    showAlert(data.message, 'success');
                    updateStats();
                    
                    // If no tasks left, show empty state
                    if (document.querySelectorAll('.task-card').length === 0) {
                        showEmptyState();
                    }
                }, 300);
            } else {
                showAlert(data.message || 'Failed to delete task', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showAlert('An error occurred while deleting the task', 'error');
        }
    }
    
    // Function to update stats
    function updateStats() {
        const taskCards = document.querySelectorAll('.task-card');
        const totalTasks = taskCards.length;
        const completedTasks = Array.from(taskCards).filter(card => card.classList.contains('completed')).length;
        const pendingTasks = totalTasks - completedTasks;
        
        // Update stats display if it exists
        const statsCards = document.querySelectorAll('.stat-card h3');
        if (statsCards.length >= 3) {
            statsCards[0].textContent = totalTasks;
            statsCards[1].textContent = completedTasks;
            statsCards[2].textContent = pendingTasks;
        }
    }
    
    // Function to show empty state
    function showEmptyState() {
        const tasksContainer = document.querySelector('.tasks-container') || document.getElementById('tasksContainer');
        if (tasksContainer) {
            tasksContainer.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-clipboard-list"></i>
                    <h2>No tasks yet</h2>
                    <p>Get started by creating your first task!</p>
                    <a href="/task/create" class="btn">
                        <i class="fas fa-plus"></i> Create Your First Task
                    </a>
                </div>
            `;
        }
    }
    
    // Add animation to task cards on load
    document.addEventListener('DOMContentLoaded', function() {
        const cards = document.querySelectorAll('.task-card');
        cards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
        });
    });
    </script>
</body>
</html>